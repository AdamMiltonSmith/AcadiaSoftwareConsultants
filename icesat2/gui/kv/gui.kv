#:kivy 1.11.1
#:import Factory kivy.factory.Factory
#:import MeshLinePlot kivy.garden.graph.MeshLinePlot


<CoordinatePopup@Popup>:
    id: coordpopup
    title: "Input coordinates"
    size: 500, 500
    size_hint: None, None
    auto_dismiss: False
    FloatLayout:
        Label:
            text: "Minimum x (e/w) coordinate"
            size: 200, 50
            size_hint: None, None
            pos_hint: {"x": 0, "top": .8}
        TextInput:
            text: "Format xx.xx"
            multiline: False
            size: 100, 25
            size_hint: None, None
            pos_hint: {"x": .1, "top": .7}
            font_size: 11
        Label:
            text: "Maximum x (e/w) coordinate"
            size: 200, 50
            size_hint: None, None
            pos_hint: {"x": .575, "top": .8}
        TextInput:
            text: "Format xx.xx"
            multiline: False
            size: 100, 25
            size_hint: None, None
            pos_hint: {"x": .675, "top": .7}
            font_size: 11
        Label:
            text: "Minimum y (e/w) coordinate"
            size: 200, 50
            size_hint: None, None
            pos_hint: {"x": 0, "top": .6}
        TextInput:
            text: "Format xx.xx"
            multiline: False
            size: 100, 25
            size_hint: None, None
            pos_hint: {"x": .1, "top": .5}
            font_size: 11
        Label:
            text: "Maximum y (e/w) coordinate"
            size: 200, 50
            size_hint: None, None
            pos_hint: {"x": .575, "top": .6}
        TextInput:
            text: "Format xx.xx"
            multiline: False
            size: 100, 25
            size_hint: None, None
            pos_hint: {"x": .675, "top": .5}
            font_size: 11
        Button:
            text: "Cancel"
            size_hint: None, None
            size: 75, 40
            pos_hint: {"x": 0, "y": 0}
            on_release: coordpopup.dismiss()
        Button:
            text: "Confirm"
            size_hint: None, None
            size: 75, 40
            pos_hint: {"right": 1, "y": 0}
            on_release: coordpopup.dismiss()
BoxLayout:
    orientation: 'vertical'
    canvas.before:
        Color:
            rgba: .99,.99,.99,1
        Rectangle:
            pos: self.pos
            size: self.size
    GridLayout:
        rows: 1
        size_hint: 1, None
        height: 35
        pos_hint: {"x": 0, "top": 1}
        canvas.before:
            Color:
                rgba: 0.9, 0.9, 0.9, 1.0
            Rectangle:
                pos: self.pos
                size: self.size
        #file
        TopButton:
            id: file_btn
            text: 'File'
            on_parent: file_dropdown.dismiss()
            on_release: file_dropdown.open(self)
            pos_hint: {"x": 0, "top": 1}
            size_hint: None, None
            width: self.texture_size[0] + 2 * file_btn.side_width_buffer
            height: file_btn.btn_height
            background_normal: ''
            background_color: file_btn.back_color
            color: file_btn.text_color
            font_size: file_btn.font_size

        TopButtonDropDown:
            id: file_dropdown
            auto_width: False
            width: 100

            TopButtonDropDownButton:
                text: 'New...'
                size_hint_y: None
                height: 30
                on_release: file_dropdown.select('new')
                font_size: file_dropdown.font_size

            TopButtonDropDownButton:
                text: 'Create'
                size_hint_y: None
                height: 30
                on_release: file_dropdown.select('create')

            TopButtonDropDownButton:
                text: 'Save'
                size_hint_y: None
                height: 30
                on_release: file_dropdown.select('save')

            TopButtonDropDownButton:
                text: 'Save As'
                size_hint_y: None
                height: 30
                on_release: file_dropdown.select('save_as')

            TopButtonDropDownButton:
                text: 'Import Data'
                size_hint_y: None
                height: 30
                on_release: file_dropdown.select('import_data')

            TopButtonDropDownButton:
                text: 'Delete'
                size_hint_y: None
                height: 30
                on_release: file_dropdown.select('delete')

        #edit
        TopButton:
            id: edit_btn
            text: 'Edit'
            on_parent: edit_dropdown.dismiss()
            on_release: edit_dropdown.open(self)
            pos_hint: {"x": 0, "top": 1}
            size_hint: None, None
            width: self.texture_size[0] + 2 * edit_btn.side_width_buffer
            height: edit_btn.btn_height
            background_normal: ''
            background_color: edit_btn.back_color
            color: edit_btn.text_color
            font_size: edit_btn.font_size

        TopButtonDropDown:
            id: edit_dropdown
            auto_width: False
            width: 100

            TopButtonDropDownButton:
                text: 'Preferences'
                size_hint_y: None
                height: 30
                on_release: edit_dropdown.select('preferences')

            TopButtonDropDownButton:
                text: 'Cut'
                size_hint_y: None
                height: 30
                on_release: edit_dropdown.select('cut')

            TopButtonDropDownButton:
                text: 'Copy'
                size_hint_y: None
                height: 30
                on_release: edit_dropdown.select('copy')

            TopButtonDropDownButton:
                text: 'Paste'
                size_hint_y: None
                height: 35
                on_release: edit_dropdown.select('paste')

        #window
        TopButton:
            id: window_btn
            text: 'Window'
            on_parent: window_dropdown.dismiss()
            on_release: window_dropdown.open(self)
            pos_hint: {"x": 0, "top": 1}
            size_hint: None, None
            width: self.texture_size[0] + 2 * window_btn.side_width_buffer
            height: window_btn.btn_height
            background_normal: ''
            background_color: window_btn.back_color
            color: window_btn.text_color
            font_size: window_btn.font_size

        TopButtonDropDown:
            id: window_dropdown
            auto_width: False
            width: 115

            TopButtonDropDownButton:
                text: 'Main View'
                size_hint_y: None
                height: 35
                on_release: window_dropdown.select('reset')
                on_release: sm.current = 'main'

            TopButtonDropDownButton:
                text: 'Graph View'
                size_hint_y: None
                height: 35
                on_release: window_dropdown.select('graph_view')
                on_release: sm.current = 'graph'

            TopButtonDropDownButton:
                text: 'Data Selection'
                size_hint_y: None
                height: 35
                on_release: window_dropdown.select('data_selection')

            TopButtonDropDownButton:
                text: 'Data Sets'
                size_hint_y: None
                height: 35
                on_release: window_dropdown.select('data_sets')

            TopButtonDropDownButton:
                text: 'Map View'
                size_hint_y: None
                height: 35
                on_release: window_dropdown.select('map_view')
                on_release: sm.current = 'map'

        #Map Button
        TopButton:
            id: map_btn
            text: 'Map'
            on_parent: map_dropdown.dismiss()
            on_release: map_dropdown.open(self)
            pos_hint: {"x": 0, "top": 1}
            size_hint: None, None
            width: self.texture_size[0] + 2 * window_btn.side_width_buffer
            height: window_btn.btn_height
            background_normal: ''
            background_color: window_btn.back_color
            color: window_btn.text_color
            font_size: window_btn.font_size

        TopButtonDropDown:
            id: map_dropdown
            auto_width: False
            width: 140

            TopButtonDropDownButton:
                text: 'Choose coordinates'
                size_hint_y: None
                height: 35
                on_release: Factory.CoordinatePopup().open()
                on_release: map_dropdown.dismiss()

        #help button
        TopButton:
            id: help_btn
            text: 'Help'
            on_parent: help_dropdown.dismiss()
            on_release: help_dropdown.open(self)
            pos_hint: {"x": 0, "top": 1}
            size_hint: None, None
            width: self.texture_size[0] + 2 * help_btn.side_width_buffer
            height: help_btn.btn_height
            background_normal: ''
            background_color: help_btn.back_color
            color: help_btn.text_color
            font_size: help_btn.font_size

        TopButtonDropDown:
            id: help_dropdown
            auto_width: False
            width: 200

            TopButtonDropDownButton:
                text: 'What would you like help with?'
                size_hint_y: None
                height: 35
                on_release: help_dropdown.select('help')
    ScreenManagement:
        id: sm
        Main_Window:
            name: 'main'
            BoxLayout:
                orientation: 'horizontal'
                BoxLayout:
                    orientation: 'vertical'
                    WindowSplitter:
                        id: graph_splitter
                        sizable_from: 'bottom'
                        strip_size: graph_splitter.border_size
                        Label:
                            text: 'Graph'
                            color: (0.0,0.0,0.0,1.0)
                    Label:
                        text: 'Map'
                        color: (0.0,0.0,0.0,1.0)
                WindowSplitter:
                    id: scroll_splitter
                    sizable_from: 'left'
                    layout_content: layout_content
                    strip_size: scroll_splitter.border_size
                    BoxLayout:
                        id: bl
                        orientation: 'vertical'
                        padding: 50, 40
                        row_default_height: '48dp'
                        row_force_default: True
                        spacing: 10, 10
                        DataSetRefreshButton:
                            id: btn_refresh
                            container: layout_content
                            text: 'Refresh List'
                            size_hint_y: None
                            #width: self.texture_size[0] + 2 * btn_refresh.side_width_buffer
                            height: btn_refresh.btn_height
                            background_normal: ''
                            background_color: btn_refresh.back_color
                            color: btn_refresh.text_color
                            font_size: btn_refresh.font_size
                            on_release:
                                self.remove_buttons()
                                self.add_buttons()
                                #app.assign(self)

                        ScrollView:
                            size: self.size
                            GridLayout:
                                id: layout_content
                                size_hint_y: None
                                cols: 1
                                row_default_height: '20dp'
                                row_force_default: True
                                spacing: 0, 5
                                padding: 0, 0
                                height: self.minimum_height

        Graph_Window:
            name: 'graph'
            BoxLayout:
                orientation: 'vertical'
                canvas.before:
                    Color:
                        rgba: .99,.99,.99,1
                Label:
                    text: 'Fullscreen Graph'
                    color: (0.0,0.0,0.0,1.0)
                Graph:
                    id: graph_test
                    plot: MeshLinePlot
                    xlabel:'X'
                    ylabel:'Y'
                    x_ticks_minor:5
                    x_tics_major:25
                    y_ticks_major:1
                    y_grid_label:True
                    x_grid_label:True
                    padding:5
                    x_grid:True
                    y_grid:True
                    xmin:-0
                    xmax:100
                    ymin:-1
                    ymax:1
                    pos: 0, root.height / 6
                    size: root.width * 2 / 3 , root.height * 18 / 24
        Map_Window:
            name: 'map'
            #on_enter: self.create_map()
            BoxLayout:
                id: map_layout
                orientation: 'vertical'
                canvas.before:
                    Color:
                        rgba: .99,.99,.99,1
                # Label:
                #     text: 'Fullscreen Map'
                #     color: (0.0,0.0,0.0,1.0)
                Map:
                    zoom: 1
                    lat: 67
                    long: 42
                
